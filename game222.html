<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æŒ‘æˆ°éŠæˆ²ï¼šå½ˆè·³çƒ</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background-color: #e6faff; }
    canvas { background: #ffffff; border: 2px solid #aaa; display: block; margin: 20px auto; }
    button { padding: 10px 20px; font-size: 16px; }
    #status { margin-top: 15px; font-size: 18px; }
  </style>
</head>
<body>
  <h1>ğŸ€ å½ˆè·³çƒéŠæˆ²ï¼šå°é»ƒå½ˆå½ˆçš„æŒ‘æˆ°</h1>
  <p>æ§åˆ¶å°ç‹—å½ˆè·³ä¸¦æ¥ä½è´è¶ï¼Œå¾—åˆ†é” 5 åˆ†å³å¯è§£é–ç²¾éˆï¼</p>
  <button onclick="startGame()">é–‹å§‹éŠæˆ²</button>
  <canvas id="gameCanvas" width="300" height="400"></canvas>
  <div id="status">å°šæœªé–‹å§‹</div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const status = document.getElementById("status");

    // åœ–ç‰‡è¼‰å…¥
    const ballImg = new Image();
    ballImg.src = 'å½ˆå½ˆçƒ.png';
    const starImg = new Image();
    starImg.src = 'æ˜Ÿæ˜Ÿ.png';

    // çƒèˆ‡æ¢æ¢è¨­å®š
    let ball = { x: 150, y: 200, radius: 30, dx: 2.2, dy: -3.2 };
    let paddle = { x: 110, width: 80, height: 10 };

    // è´è¶åœ–ç‰‡é¡¯ç¤ºå¤§ï¼Œç¢°æ’åˆ¤å®šå°
    let star = { x: 100, y: 50, size: 120 }; // è´è¶åœ–é¡¯ç¤ºå¤§
    let starHitbox = { width: 32, height: 32 }; // è´è¶ç¢°æ’åˆ¤æ–·å°

    let score = 0;
    let gameLoop;
    let playing = false;
    let waitingForPaddle = false;
    let showingUnlockMessage = false;

    // æ»‘é¼ ç§»å‹•
    document.addEventListener("mousemove", e => {
      const rect = canvas.getBoundingClientRect();
      paddle.x = e.clientX - rect.left - paddle.width / 2;
    });

// è§¸æ§æ‹–æ›³
    let isTouching = false;
      canvas.addEventListener('touchstart', function(e) {
      isTouching = true;
      const rect = canvas.getBoundingClientRect();
      const touch = e.touches[0];
      paddle.x = touch.clientX - rect.left - paddle.width / 2;
      e.preventDefault();
    });
    canvas.addEventListener('touchmove', function(e) {
      if (!isTouching) return;
      const rect = canvas.getBoundingClientRect();
      const touch = e.touches[0];
      paddle.x = touch.clientX - rect.left - paddle.width / 2;
      e.preventDefault();
    });
    canvas.addEventListener('touchend', function() {
      isTouching = false;
    });


    function drawBall() {
      ctx.drawImage(ballImg, ball.x - ball.radius, ball.y - ball.radius, ball.radius * 2, ball.radius * 2);
    }

    function drawPaddle() {
      ctx.fillStyle = "#0077cc";
      ctx.fillRect(paddle.x, canvas.height - paddle.height - 10, paddle.width, paddle.height);
    }

    function drawStar() {
      if (!waitingForPaddle) {
        ctx.drawImage(starImg, star.x, star.y, star.size, star.size);
        // å¦‚è¦çœ‹ç¢°æ’ç¯„åœå¯è§£è¨»ä¸‹è¡Œ
        // ctx.strokeStyle = "rgba(255,0,0,0.7)";
        // ctx.strokeRect(star.x + (star.size - starHitbox.width)/2, star.y + (star.size - starHitbox.height)/2, starHitbox.width, starHitbox.height);
      }
    }

    function moveBall() {
      ball.x += ball.dx;
      ball.y += ball.dy;

      if (ball.x < ball.radius || ball.x > canvas.width - ball.radius) ball.dx *= -1;
      if (ball.y < ball.radius) ball.dy *= -1;

      // Paddle collision
      if (
        ball.y + ball.radius > canvas.height - paddle.height - 10 &&
        ball.x > paddle.x &&
        ball.x < paddle.x + paddle.width
      ) {
        ball.dy *= -1;
        if (waitingForPaddle) {
          resetStar();
          waitingForPaddle = false;
        }
      }

      // Star collisionï¼ˆä»¥hitboxç‚ºæº–ï¼‰
      if (
        !waitingForPaddle &&
        ball.x + ball.radius > star.x + (star.size - starHitbox.width)/2 &&
        ball.x - ball.radius < star.x + (star.size - starHitbox.width)/2 + starHitbox.width &&
        ball.y + ball.radius > star.y + (star.size - starHitbox.height)/2 &&
        ball.y - ball.radius < star.y + (star.size - starHitbox.height)/2 + starHitbox.height
      ) {
        score++;
        waitingForPaddle = true;
        if (score >= 5) {
          unlockSpirit();
          return;
        }
      }

      if (ball.y > canvas.height) {
        stopGame();
        status.innerText = "ğŸ’¥ éŠæˆ²çµæŸï¼Œè«‹å†è©¦ä¸€æ¬¡ï¼";
      }
    }

    function resetStar() {
      const maxX = canvas.width - star.size;
      const maxY = (canvas.height / 2) - star.size;
      star.x = Math.random() * maxX;
      star.y = Math.random() * maxY;
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBall();
      drawPaddle();
      drawStar();
      moveBall();
      if (!showingUnlockMessage)
        status.innerText = "å¾—åˆ†ï¼š" + score;
    }

    function startGame() {
      ball = { x: 150, y: 200, radius: 30, dx: 2.2, dy: -3.2 };
      score = 0;
      waitingForPaddle = false;
      showingUnlockMessage = false;
      resetStar();
      status.innerText = "éŠæˆ²é–‹å§‹ï¼å¾—åˆ†ï¼š" + score;
      playing = true;
      gameLoop = setInterval(draw, 20);
    }

    function stopGame() {
      clearInterval(gameLoop);
      playing = false;
    }

    function unlockSpirit() {
      const spirit = {
        id: 'spirit_game2',
        name: 'å°é»ƒå½ˆå½ˆ',
        image: 'images/game-spirit2.png',
        page: 'spirit_game2.html'
      };
      let spirits = JSON.parse(localStorage.getItem('spirits') || '[]');
      if (!spirits.some(s => s.id === spirit.id)) {
        spirits.push(spirit);
        localStorage.setItem('spirits', JSON.stringify(spirits));
        status.innerText = 'ğŸ‰ æ­å–œè§£é–ç²¾éˆï¼šå°é»ƒå½ˆå½ˆï¼';
      } else {
        status.innerText = 'ä½ å·²ç¶“æ“æœ‰é€™ä½ç²¾éˆå›‰ï¼';
      }
      showingUnlockMessage = true;
      setTimeout(() => {
        showingUnlockMessage = false;
        stopGame();
      }, 1500); // é¡¯ç¤º1.5ç§’å†çµæŸéŠæˆ²
    }
  </script>

  <br><br>
  <a href="index.html">ğŸ”™ è¿”å›ä¸»é </a>
</body>
</html>
