<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æŒ‘æˆ°éŠæˆ²ï½œå°é»ƒå½ˆå½ˆ å½ˆè·³çƒ</title>
  <link rel="stylesheet" href="styles.css">
  <style>
.stage{position:relative;max-width:720px;margin:0 auto;border-radius:16px;background:linear-gradient(180deg,#cdefff,#f8ffff)}.canvas-wrap{position:relative;padding:10px}canvas{background:#ffffff;border:2px solid #cfe4ff;border-radius:12px;display:block;margin:0 auto;box-shadow:0 10px 22px rgba(0,0,0,.06)}.hud{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin:10px 0 12px}.hint{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}.hint .bubble{background:rgba(255,255,255,.9);border:1px solid var(--section-border);border-radius:14px;padding:8px 12px;font-weight:800;box-shadow:0 8px 20px rgba(0,0,0,.08)}.btn:active{transform:translateY(1px)}@media (max-width:560px){
      .hero{grid-template-columns:84px 1fr}
</style>
</head>
<body class="theme-sky">
  <div class="container">
    <div class="card">
      <div class="header">
        <div class="title">æŒ‘æˆ°éŠæˆ² - å°é»ƒå½ˆå½ˆï¼ˆå½ˆè·³çƒï¼‰</div>
        <div class="badge">ğŸ® æŒ‘æˆ°ç³» Â· å‹å‡ºå¯è§£é–</div>
      </div>

      <div class="hero">
        <div class="img-wrap"><img src="images/game-spirit2.png" alt="å°é»ƒå½ˆå½ˆ"></div>
        <div class="intro">
          <p><strong>ç©æ³•ï¼š</strong>æ§åˆ¶æ“‹æ¿ä»¤å°ç‹—å½ˆèµ·è¿½è´è¶ï¼›å¾—åˆ†é” <strong>5 åˆ†</strong> å³å¯è§£é–ã€‚</p>
          <p>æ»‘é¼ å·¦å³ç§»å‹•ï¼ˆæˆ–è§¸æ§æ‹–å‹•ï¼‰å³å¯æ§åˆ¶æ“‹æ¿ã€‚</p>
          <div class="status-bar">
            <span class="pill info" id="pill-status">å°šæœªé–‹å§‹</span>
            <span class="pill ok" id="pill-score">å¾—åˆ†ï¼š0 / 5</span>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="game-wrap">
          <div class="stage">
            <div class="hud">
              <span class="pill">ğŸ¯ å‘½ä¸­è´è¶å¯å¾— 1 åˆ†</span>
              <span class="pill">ğŸ›¡ æ“‹æ¿åå½ˆä¸ä¸­æœƒè·Œè½</span>
            </div>
            <div class="canvas-wrap">
              <canvas id="gameCanvas" width="300" height="400"></canvas>
              <div class="hint" id="hint"><div class="bubble">â† â†’ æ»‘é¼ ç§»å‹•æ§åˆ¶ï¼ˆæ‰‹æ©Ÿï¼šæ‹–å‹•ï¼‰</div></div>
            </div>
          </div>

          <div class="actions">
            <button class="btn" id="btn-start">â–¶ï¸ é–‹å§‹éŠæˆ²</button>
            <button class="btn secondary" id="btn-retry" style="display:none;">ğŸ” é‡æ–°é–‹å§‹</button>
          </div>
        </div>

        <div class="actions">
          <a class="btn secondary" href="index.html">ğŸ”™ è¿”å›ä¸»é </a>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">ğŸ‰ å·²è§£é–ï¼šå°é»ƒå½ˆå½ˆï¼</div>

  <script>
    // åœ–ç‰‡è¼‰å…¥
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const statusEl = document.getElementById("pill-status");
    const scoreEl  = document.getElementById("pill-score");
    const btnStart = document.getElementById("btn-start");
    const btnRetry = document.getElementById("btn-retry");
    const hint     = document.getElementById("hint");

    const ballImg = new Image();  ballImg.src = 'å½ˆå½ˆçƒ.png';
    const starImg = new Image();  starImg.src = 'æ˜Ÿæ˜Ÿ.png';

    let ball, paddle, star, starHitbox, score, gameLoop, waitingForPaddle, showingUnlockMessage, playing;

    function initVars(){
      ball = { x: 150, y: 200, radius: 30, dx: 2.2, dy: -3.2 };
      paddle = { x: 110, width: 80, height: 10 };
      star = { x: 100, y: 50, size: 120 };
      starHitbox = { width: 32, height: 32 };
      score = 0; waitingForPaddle = false; showingUnlockMessage = false; playing = false;
      scoreEl.textContent = "å¾—åˆ†ï¼š0 / 5";
      statusEl.textContent = "å°šæœªé–‹å§‹";
      hint.style.display = 'flex';
    }

    initVars();

    // æ§åˆ¶ï¼šæ»‘é¼  + è§¸æ§
    function setPaddleByClientX(clientX){
      const rect = canvas.getBoundingClientRect();
      paddle.x = clientX - rect.left - paddle.width / 2;
    }
    document.addEventListener("mousemove", e => { if(playing) setPaddleByClientX(e.clientX); });
    canvas.addEventListener("touchmove", e => { if(!playing) return; e.preventDefault(); setPaddleByClientX(e.touches[0].clientX); }, {passive:false});

    function drawBall(){ ctx.drawImage(ballImg, ball.x - ball.radius, ball.y - ball.radius, ball.radius*2, ball.radius*2); }
    function drawPaddle(){ ctx.fillStyle = "#0e74d0"; ctx.fillRect(paddle.x, canvas.height - paddle.height - 10, paddle.width, paddle.height); }
    function drawStar(){
      if (!waitingForPaddle) {
        ctx.drawImage(starImg, star.x, star.y, star.size, star.size);
        // èª¿è©¦ Hitbox æ™‚å¯é–‹å•Ÿï¼š
        // ctx.strokeStyle = "rgba(255,0,0,0.6)";
        // ctx.strokeRect(star.x + (star.size - starHitbox.width)/2, star.y + (star.size - starHitbox.height)/2, starHitbox.width, starHitbox.height);
      }
    }

    function resetStar(){
      const maxX = canvas.width - star.size;
      const maxY = (canvas.height / 2) - star.size;
      star.x = Math.random() * maxX;
      star.y = Math.random() * maxY;
    }

    function moveBall(){
      ball.x += ball.dx; ball.y += ball.dy;
      if (ball.x < ball.radius || ball.x > canvas.width - ball.radius) ball.dx *= -1;
      if (ball.y < ball.radius) ball.dy *= -1;

      // æ“‹æ¿ç¢°æ’
      if (ball.y + ball.radius > canvas.height - paddle.height - 10 &&
          ball.x > paddle.x && ball.x < paddle.x + paddle.width) {
        ball.dy *= -1;
        if (waitingForPaddle) { resetStar(); waitingForPaddle = false; }
      }

      // æ˜Ÿæ˜Ÿç¢°æ’ï¼ˆä»¥ Hitbox ç‚ºæº–ï¼‰
      if (!waitingForPaddle &&
          ball.x + ball.radius > star.x + (star.size - starHitbox.width)/2 &&
          ball.x - ball.radius < star.x + (star.size - starHitbox.width)/2 + starHitbox.width &&
          ball.y + ball.radius > star.y + (star.size - starHitbox.height)/2 &&
          ball.y - ball.radius < star.y + (star.size - starHitbox.height)/2 + starHitbox.height) {
        score++; waitingForPaddle = true;
        scoreEl.textContent = `å¾—åˆ†ï¼š${score} / 5`;
        statusEl.textContent = 'å‘½ä¸­ï¼å½ˆå›å»å†è¿½ä¸‹ä¸€éš»ï½';
        if (score >= 5) { unlockSpirit(); return; }
      }

      if (ball.y > canvas.height) { stopGame(); statusEl.textContent = "ğŸ’¥ éŠæˆ²çµæŸï¼Œè«‹å†è©¦ä¸€æ¬¡ï¼"; btnRetry.style.display='inline-flex'; }
    }

    function draw(){
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBall(); drawPaddle(); drawStar(); moveBall();
    }

    function startGame(){
      initVars(); resetStar();
      statusEl.textContent = "éŠæˆ²é–‹å§‹ï¼"; hint.style.display='none';
      playing = true; btnStart.style.display='none'; btnRetry.style.display='none';
      clearInterval(gameLoop); gameLoop = setInterval(draw, 20);
    }

    function stopGame(){ clearInterval(gameLoop); playing = false; }

    function toast(msg){
      const t = document.getElementById('toast');
      t.textContent = msg; t.style.display='block';
      setTimeout(()=> t.style.display='none', 1600);
    }

    // âœ… è§£é–å¾Œ 2 ç§’è‡ªå‹•è·³è½‰åˆ°ç²¾éˆé 
    function unlockSpirit(){
      const spirit = { id:'spirit_game2', name:'å°é»ƒå½ˆå½ˆ', image:'images/game-spirit2.png', page:'spirit_game2.html' };
      let spirits = JSON.parse(localStorage.getItem('spirits') || '[]');
      if (!spirits.some(s => s.id === spirit.id)) {
        spirits.push(spirit); localStorage.setItem('spirits', JSON.stringify(spirits));
        toast('ğŸ‰ å·²è§£é–ï¼šå°é»ƒå½ˆå½ˆï¼'); statusEl.textContent='ğŸ‰ æˆåŠŸè§£é–æŒ‘æˆ°ç²¾éˆï¼šå°é»ƒå½ˆå½ˆï¼';
      } else { statusEl.textContent='ä½ å·²ç¶“æ“æœ‰å‘¢ä½ç²¾éˆå–‡ï¼'; }

      stopGame(); // åœæ­¢ç•«é¢æ›´æ–°
      setTimeout(()=>{ window.location.href = spirit.page; }, 2000); // è‡ªå‹•è·³è½‰
    }

    document.getElementById("btn-start").addEventListener("click", startGame);
    document.getElementById("btn-retry").addEventListener("click", startGame);
  </script>
</body>
</html>
