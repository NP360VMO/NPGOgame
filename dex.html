<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>精靈圖鑑 - 昂坪360 GO</title>
  <link rel="stylesheet" href="styles.css">
  
  <script src="spirits.js"></script>
<style>
    /* Page-specific light tweaks for the Dex page */
    body { background-image: linear-gradient(to bottom, rgba(255,255,255,.85), rgba(255,255,255,.75) 30%, rgba(255,255,255,.65) 100%), url('images/background.png'); background-size: cover; background-position: center; background-repeat: no-repeat; background-attachment: fixed; }
    .dex-hero { text-align: center; padding: clamp(18px, 5vw, 40px) 12px 8px; }
    .dex-title { font-size: clamp(22px, 4.8vw, 36px); font-weight: 900; color: var(--accent-ink); margin: 0 0 6px; }
    .dex-sub { font-size: clamp(13px, 3vw, 16px); color: rgba(0,0,0,.75); margin: 0 auto 10px; max-width: 820px; }
    .dex-controls { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin: 10px 0 12px; }
    .dex-search { min-width: 220px; max-width: 420px; width: 60%; }
    .dex-search input { width: 100%; padding: 10px 12px; border-radius: 999px; border: 2px solid var(--section-border); background: #fff; font-weight: 700; color: var(--ink); }
    .dex-tabs { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; }
    .dex-tab { border: 2px solid var(--accent); color: var(--accent-ink); background: transparent; padding: 8px 12px; border-radius: 999px; font-weight: 800; cursor: pointer; }
    .dex-tab.active { background: var(--accent); color: #fff; }
    .dex-progress { background: var(--card); border:1px solid var(--section-border); border-radius: 16px; padding: 12px; box-shadow: 0 8px 24px rgba(0,0,0,.06); max-width: 820px; margin: 0 auto; }
    .progress { display:flex; align-items:center; gap:10px; justify-content:center; margin: 8px auto 0; flex-wrap: wrap; }
    .progress-bar { position:relative; height:10px; width:min(560px, 90%); background:#e9eef5; border-radius:999px; overflow:hidden; }
    .progress-fill { height:100%; width:0%; background: var(--accent); transition: width .4s ease; }
    .progress-text { font-weight:800; color:var(--accent-ink); }

    .dex-wrap { max-width: 1100px; margin: 14px auto 28px; padding: 0 12px; }
    .dex-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 14px; }
    @media (max-width: 360px) { .dex-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; } }

    .dex-card { background: var(--section-bg); border:1px solid var(--section-border); border-radius: 14px; padding: 12px; text-align: center; box-shadow: 0 8px 20px rgba(0,0,0,.06); transition: transform .12s ease, box-shadow .2s ease; }
    .dex-card:hover { transform: translateY(-2px); box-shadow: 0 12px 26px rgba(0,0,0,.12); }
    .dex-card img { width: 120px; max-width: 70%; height:auto; filter: drop-shadow(0 8px 18px rgba(0,0,0,.12)); }
    .dex-name { margin-top: 8px; font-weight: 900; color: var(--ink); font-size: clamp(14px, 2.6vw, 16px); }
    .dex-type { font-size: 12px; color: #7a8699; }
    .unknown img { filter: grayscale(100%) brightness(60%); }
    .unknown .dex-name { color: #9aa7b1; }
    .unknown .dex-type { color: #b8c0c7; }
    .dex-footer { text-align: center; margin: 18px 0 24px; }
  </style>

  <style>
    /* --- extras for lock badge & unlocked ribbon + theme sync controls --- */
    .dex-card { position: relative; overflow: clip; }
    .dex-card .ribbon {
      position: absolute; top: 10px; left: -40px;
      transform: rotate(-35deg);
      background: var(--accent);
      color: #fff; font-weight: 900; font-size: 12px;
      padding: 6px 60px; box-shadow: 0 4px 10px rgba(0,0,0,.15);
      letter-spacing: .5px;
    }
    .dex-card.unknown .ribbon { display: none; }

    /* Lock corner */
    .dex-card.unknown::after {
      content: "🔒";
      position: absolute; top: 8px; right: 8px;
      font-size: 18px; opacity: .55; pointer-events: none;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,.1));
    }

    /* Hover CTA for unknown */
    .dex-card.unknown:hover { box-shadow: 0 12px 26px rgba(0,0,0,.14); }
    .dex-card.unknown img { cursor: pointer; }

    /* Top theme sync indicator (hidden, just for accessibility) */
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
  </style>


  <style>
    .dex-columns { display:grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 920px) { .dex-columns { grid-template-columns: 1fr 1fr; } }
    .dex-sec-title { margin: 0 0 8px; font-size: clamp(16px, 2.8vw, 18px); color: var(--accent-ink); text-align: center; }
    .dex-section { background: var(--card); border:1px solid var(--section-border); border-radius: 16px; padding: 12px; box-shadow: 0 8px 24px rgba(0,0,0,.05); }
  </style>

</head>
<body class="theme-sky">
  <a id="dex"></a>
  <div class="container">
    <div class="dex-hero">
      <div class="dex-title">精靈圖鑑</div>
      <div class="dex-sub">在昂坪市集追蹤精靈的神秘蹤跡！點擊精靈圖示，揭開隱藏線索，解鎖奇幻秘密。部分害羞精靈只在特定地點現身，快來探索吧！</div>

      
      <div class="dex-controls">
        <div class="dex-search"><input id="q" type="search" placeholder="🔎 搜尋名稱或類型…"></div>
        <div class="dex-tabs" id="status-filters">
          <button class="dex-tab active" data-show="all">全部</button>
          <button class="dex-tab" data-show="known">已解鎖</button>
          <button class="dex-tab" data-show="unknown">未解鎖</button>
        </div>
      </div>

        </div>

      <div class="dex-progress">
        <div class="progress">
          <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
          <div id="progress-text" class="progress-text">0 / 0</div>
        </div>
      </div>
    </div>

    
    <div class="dex-wrap">
      <div class="dex-columns">
        <section class="dex-section">
          <h3 class="dex-sec-title">探索系</h3>
          <div class="dex-grid" id="dex-explore"></div>
        </section>
        <section class="dex-section">
          <h3 class="dex-sec-title">挑戰系</h3>
          <div class="dex-grid" id="dex-challenge"></div>
        </section>
      </div>
    </div>


    <div class="dex-footer">
      <a class="btn secondary" href="index.html">🔙 返回主頁</a>
    </div>
  </div>

  <script>

    // --- Theme sync (read from localStorage like index) ---
    (function syncTheme(){
      const saved = localStorage.getItem('np_theme');
      if (!saved) return;
      document.body.classList.remove('theme-sky','theme-grass','theme-warm','theme-dimsum','theme-boba');
      document.body.classList.add(saved);
    })();

    const allSpirits = window.SPIRITS;

    const gridExplore = document.getElementById('dex-explore');
const gridChallenge = document.getElementById('dex-challenge');
const q = document.getElementById('q');
    const statusButtons = Array.from(document.querySelectorAll('#status-filters .dex-tab'));
    const collected = new Set((JSON.parse(localStorage.getItem('spirits') || '[]')).map(s => s.id));
    const progressFill = document.getElementById('progress-fill');
    const progressText = document.getElementById('progress-text');

    
    function render(show = 'all', keyword = '') {
      gridExplore.innerHTML = '';
      gridChallenge.innerHTML = '';

      const kw = keyword.trim().toLowerCase();
      const byStatus = (s) => {
        const known = collected.has(s.id);
        if (show === 'known') return known;
        if (show === 'unknown') return !known;
        return true;
      };
      const byKeyword = (s) => kw === '' || s.name.toLowerCase().includes(kw) || s.type.toLowerCase().includes(kw);

      const listExplore = allSpirits.filter(s => s.type === '探索系' && byStatus(s) && byKeyword(s));
      const listChallenge = allSpirits.filter(s => s.type === '🎮 挑戰系' && byStatus(s) && byKeyword(s));

      const buildCard = (s) => {
        const known = collected.has(s.id);
        const card = document.createElement('div');
        card.className = 'dex-card' + (known ? '' : ' unknown');
        card.setAttribute('data-spirit-id', s.id);

        if (known) {
          card.innerHTML = `
            <span class="ribbon">✅ 已解鎖</span>
            <a href="${s.page}" style="text-decoration:none;">
              <img src="${s.image}" alt="${s.name}">
              <div class="dex-name">${s.name}</div>
              <div class="dex-type">${s.type}</div>
            </a>`;
        } else {
          card.innerHTML = `
              <img src="${s.image}" alt="???" style="cursor:pointer">
              <div class="dex-name">???</div>
              <div class="dex-type">${s.type}</div>`;
          card.querySelector('img').addEventListener('click', () => alert(s.prompt));
        }
        return card;
      };

      listExplore.forEach(s => gridExplore.appendChild(buildCard(s)));
      listChallenge.forEach(s => gridChallenge.appendChild(buildCard(s)));

      const total = allSpirits.length;
      const have = collected.size;
      const pct = Math.min(100, Math.round((have / total) * 100));
      progressFill.style.width = pct + '%';
      progressText.textContent = `${have} / ${total}`;
    }

        statusButtons.forEach(btn => btn.addEventListener('click', () => {
      statusButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      render(btn.dataset.show, q.value);
    }));

    q.addEventListener('input', () => {
      const active = document.querySelector('#status-filters .dex-tab.active')?.dataset.show || 'all';
      render(active, q.value);
    });

    // Initial render
    render('all', '');
  </script>
</body>
</html>
